machine:
  services:
    - docker

dependencies:
  override:
    - docker version
    - docker build -t oncoscape:$CIRCLE_SHA1 .


test:
  override:
    - docker run -d -p 7777:7777 --name oncoscape-$CIRCLE_SHA1 oncoscape:$CIRCLE_SHA1; sleep 10
    - curl --retry 10 --retry-delay 5 -v http://localhost:7777
    - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' oncoscape-$CIRCLE_SHA1)" -- bash -c "make test"
